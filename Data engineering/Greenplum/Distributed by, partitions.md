**Greenplum —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–∑–ª–∞—Ö, –∏ –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –Ω–∏–º–∏!**

üîπ **–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã —Å `DISTRIBUTED BY`:**


`CREATE TABLE sales (     
	id SERIAL PRIMARY KEY,     
	product_id INT,     
	amount DECIMAL(10,2),     
	sale_date DATE 
) DISTRIBUTED BY (product_id); -- –ö–ª—é—á —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è`

üìå **–ß—Ç–æ —Ç—É—Ç –≤–∞–∂–Ω–æ?**

- `DISTRIBUTED BY (product_id)` ‚Üí **–∑–∞–ø–∏—Å–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `product_id` –±—É–¥—É—Ç –Ω–∞ –æ–¥–Ω–æ–º —É–∑–ª–µ**.
- –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –º–µ–∂—É–∑–ª–æ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–∏ `JOIN`, `GROUP BY`, `COUNT(*)`.

‚úÖ **–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –∫–ª—é—á `DISTRIBUTED BY`?**

- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å **—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω** (—á—Ç–æ–±—ã —É–∑–ª—ã —Ä–∞–±–æ—Ç–∞–ª–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ).
- –ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–º–∞–ª–æ—Ä–∞–∑–º–µ—Ä–Ω—ã–º** (`DISTRIBUTED BY (country_code)` ‚ùå, –µ—Å–ª–∏ –≤—Å–µ–≥–æ 5 —Å—Ç—Ä–∞–Ω ‚Üí –¥–∏—Å–±–∞–ª–∞–Ω—Å).
- –î–ª—è JOIN-–æ–≤ **–ª—É—á—à–µ –≤—ã–±–∏—Ä–∞—Ç—å –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–≤—è–∑–∫–∞—Ö** (`user_id`, `order_id`).

üîπ **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ?**

`SELECT gp_segment_id, COUNT(*)  FROM sales  GROUP BY gp_segment_id;`


# **`EXPLAIN ANALYZE` (–∞–Ω–∞–ª–∏–∑ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤)**

üìå **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–ø—Ä–æ—Å?**

üîπ **–ò—Å–ø–æ–ª—å–∑—É–µ–º `EXPLAIN ANALYZE`:**

`EXPLAIN ANALYZE  
`SELECT product_id, SUM(amount)  
`FROM sales  
`GROUP BY product_id;`

üìå **–í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç:**  
‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (`Total runtime`)  
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤  
‚úÖ –ï—Å—Ç—å –ª–∏ **BroadCast Motion** (–µ—Å–ª–∏ –µ—Å—Ç—å, –∑–Ω–∞—á–∏—Ç `JOIN` –Ω–µ–æ–ø—Ç–∏–º–∞–ª–µ–Ω)

üîπ **–ß—Ç–æ —Ç–∞–∫–æ–µ `Motion`?**

- `Broadcast Motion` ‚Üí **–∫–æ–ø–∏—Ä—É–µ—Ç –≤—Å—é —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –≤—Å–µ —É–∑–ª—ã** (–æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ!)
- `Redistribute Motion` ‚Üí **–ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏** (–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –ª—É—á—à–µ, —á–µ–º Broadcast)
- **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç** ‚Üí **–±–µ–∑ Motion**, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –ª–µ–∂–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

üìå **–ö–∞–∫ —É–º–µ–Ω—å—à–∏—Ç—å `Motion`?**  
‚úÖ **–í—ã–±–∏—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `DISTRIBUTED BY`**, —á—Ç–æ–±—ã `JOIN` –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –¥–∞–Ω–Ω—ã—Ö.  
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`ANALYZE`** –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–∞–±–ª–∏—Ü—ã:


`ANALYZE sales;`

‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å **–∏–Ω–¥–µ–∫—Å—ã** (`CREATE INDEX ON sales(product_id);`)


# **`PARTITION BY` (–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü)**

üìå **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ = –ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ —á–∞—Å—Ç–∏ (–ø–∞—Ä—Ç–∏—Ü–∏–∏) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.**

üîπ **–ü—Ä–∏–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–æ –¥–∞—Ç–µ:**
 

`CREATE TABLE sales (     
	`id SERIAL PRIMARY KEY,     
	`product_id INT,     
	`amount DECIMAL(10,2),     
	`sale_date DATE 
`) PARTITION BY RANGE (sale_date) ( 
	`PARTITION sales_2023 START ('2023-01-01') END ('2023-12-31'),     
	`PARTITION sales_2024 START ('2024-01-01') END ('2024-12-31') 
`);`

üìå **–ü–æ—á–µ–º—É —ç—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É?**

- –ö–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å `WHERE sale_date BETWEEN '2024-01-01' AND '2024-01-31'`, Greenplum **—á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é** (Partition Pruning).

‚úÖ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?**

- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ **–∏–º–µ—é—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥–µ–ª–µ–Ω–∏–µ** (`date`, `region_id`).
- –ï—Å–ª–∏ –µ—Å—Ç—å **–æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã** (–º–∏–ª–ª–∏–æ–Ω—ã/–º–∏–ª–ª–∏–∞—Ä–¥—ã —Å—Ç—Ä–æ–∫).

# **–ö–∞–∫ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Greenplum? (`COPY`, `INSERT`, `gpload`)**

‚úÖ **–°–ø–æ—Å–æ–±—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Greenplum:**

üîπ **1. `COPY` (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –º–µ—Ç–æ–¥)**

`COPY sales FROM '/data/sales.csv' WITH DELIMITER ',' CSV HEADER;`

üìå **–ü–æ—á–µ–º—É —ç—Ç–æ –±—ã—Å—Ç—Ä–æ?**

- `COPY` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –≤–æ –≤—Å–µ —Å–µ–≥–º–µ–Ω—Ç—ã Greenplum.

---

üîπ **2. `INSERT` (–º–µ–¥–ª–µ–Ω–Ω–æ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö)**

`INSERT INTO sales (product_id, amount, sale_date) VALUES (1, 100.50, '2024-02-10');`

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ï—Å–ª–∏ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è **–µ–¥–∏–Ω–∏—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏** (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏).

---

üîπ **3. `gpload` (ETL-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–∞—Å—Å–æ–≤–æ)**

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ **–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö**.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª—ã **YAML-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏.

üìå **–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `gpload` (YAML-—Ñ–∞–π–ª):**

yaml

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å

`VERSION: 1.0.0.1 DATABASE: my_database USER: my_user HOST: gp_master PORT: 5432 TABLE: sales MODE: INSERT FORMAT: CSV DELIMITER: ',' ERROR_LIMIT: 100`

üìå **–ó–∞–ø—É—Å–∫ gpload:**

bash

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å

`gpload -f gpload_config.yml`

‚úÖ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ **–∑–∞–≥—Ä—É–∂–∞—Ç—å –≥–∏–≥–∞–±–∞–π—Ç—ã –¥–∞–Ω–Ω—ã—Ö** –∏–∑ —Ñ–∞–π–ª–æ–≤ (–±—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ).