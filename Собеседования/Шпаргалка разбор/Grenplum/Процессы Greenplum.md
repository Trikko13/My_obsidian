
В Greenplum важную роль играют процессы **Query Dispatcher (QD)** и **Query Executor (QE)**. Эти процессы обеспечивают управление и выполнение запросов в распределённой среде, что позволяет Greenplum обрабатывать большие объёмы данных параллельно на множестве узлов. Давай рассмотрим их функции и связь с процессом **postmaster**.

### 1. Query Dispatcher (QD)

- **Роль**: QD — это процесс на мастер-ноде, который отвечает за координацию выполнения запросов.
- **Функции QD**:
    - Получает запрос от клиента и анализирует его.
    - Разбивает запрос на подзапросы и направляет их на сегментные узлы.
    - Собирает промежуточные результаты от сегментов и выполняет финальную агрегацию, если это необходимо.
    - Возвращает результат клиенту.
- **Как работает QD**: QD, по сути, действует как центр управления и дирижер: он направляет каждый сегмент выполнять свою часть запроса и координирует их взаимодействие. Именно QD запускает выполнение финального блока `SELECT` на мастер-узле.

### 2. Query Executor (QE)

- **Роль**: QE — это процесс, который выполняется на каждом сегменте для обработки полученных запросов.
- **Функции QE**:
    - Выполняет подзапросы, направленные от QD на мастер-ноде.
    - Проводит операции с локальными данными на сегменте (например, фильтрацию, агрегацию) и возвращает промежуточные результаты на мастер-узел.
- **Как работает QE**: На каждом сегменте работает один или несколько QE-процессов, которые обрабатывают свою часть данных. Когда QD отправляет подзапрос на сегменты, QE-процессы выполняют его и отдают результаты обратно QD для дальнейшей обработки.

### 3. Процесс Postmaster

- **Роль**: Postmaster — это базовый управляющий процесс PostgreSQL, который присутствует и в Greenplum на всех узлах (и мастер, и сегменты).
- **Функции Postmaster**:
    - Управляет созданием новых процессов для каждого подключения клиента.
    - Запускает процессы QD и QE в зависимости от узла (QD на мастер-ноде и QE на сегментах).
    - Обрабатывает аварийные ситуации и завершает зависшие процессы, что помогает поддерживать устойчивость системы.
    - Управляет ресурсами и следит за корректным завершением всех процессов.
- **Как работает Postmaster**: Когда клиент подключается к базе, процесс postmaster запускается, создаёт необходимый процесс (QD или QE) и обеспечивает их координацию. На мастер-ноде postmaster запускает QD для каждого нового клиентского подключения. На сегментах postmaster запускает QE-процессы, когда приходит запрос от QD.

### Итоговая схема взаимодействия QD, QE и Postmaster

1. **Подключение клиента**: Клиент подключается к мастер-ноде, и postmaster запускает процесс QD.
2. **Распределение запроса**: QD разбивает запрос на подзапросы и отправляет их на сегменты. На сегментах postmaster запускает QE-процессы для выполнения подзапросов.
3. **Выполнение и сборка результатов**: QE на каждом сегменте обрабатывает данные и возвращает результаты QD. QD на мастер-ноде выполняет финальную агрегацию.
4. **Завершение запроса**: Postmaster следит за завершением всех процессов и освобождает ресурсы после выполнения запроса.

Таким образом, **postmaster** является базовым управляющим процессом, который запускает и контролирует QD и QE, обеспечивая устойчивую работу всей системы Greenplum.

Так же есть [[компонент Interconnect]]