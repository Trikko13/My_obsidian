## **3. Основные виды вложенных запросов**

### **1. Вложенные запросы в `WHERE`**

Используются для фильтрации данных на основе результата другого запроса.

**Пример: Найти сотрудников, у которых зарплата выше средней.**

SELECT name, salary
FROM employees
WHERE salary > (
    SELECT AVG(salary)
    FROM employees
);


---

### **2. Вложенные запросы в `FROM`**

Часто называются "временными таблицами". Используются для создания промежуточных наборов данных.

**Пример: Найти среднюю зарплату по отделам.**

SELECT department_id, AVG(salary) AS avg_salary
FROM (
    SELECT department_id, salary
    FROM employees
    WHERE hire_date > '2020-01-01'
) subquery
GROUP BY department_id;


---

### **3. Вложенные запросы в `SELECT`**

Используются для вычисления значений на основе данных из другого запроса.

**Пример: Вывести имя сотрудника и его зарплату как процент от средней зарплаты.**

SELECT name, 
       salary, 
       salary / (SELECT AVG(salary) FROM employees) AS salary_ratio
FROM employees;


---

### **4. Вложенные запросы с `EXISTS`**

Используются для проверки существования записей в подзапросе.

**Пример: Найти отделы, в которых есть сотрудники с зарплатой больше 100,000.**

SELECT department_id
FROM departments d
WHERE EXISTS (
    SELECT 1
    FROM employees e
    WHERE e.department_id = d.department_id
    AND e.salary > 100000
);


---

### **5. Вложенные запросы с `IN`**

Используются для фильтрации данных, которые соответствуют результату подзапроса.

**Пример: Найти сотрудников, работающих в отделах, созданных после 2015 года.**
SELECT name
FROM employees
WHERE department_id IN (
    SELECT department_id
    FROM departments
    WHERE created_date > '2015-01-01'
);


---

## **4. Как строить вложенные запросы? (Шаги)**

1. **Определи задачу:**
    
    - Что требуется найти? Какие данные нужны?
2. **Раздели задачу на подзадачи:**
    
    - Какую промежуточную информацию нужно вычислить?
    - Например:
        - Средняя зарплата.
        - Список ID, которые нужно сравнить.
3. **Начни с вложенного запроса:**
    
    - Построй сначала вложенный запрос и убедись, что он работает правильно.
4. **Подключи вложенный запрос к основному:**
    
    - Подумай, где он будет использоваться: `WHERE`, `FROM`, `SELECT`.
5. **Проверь результат:**
    
    - Убедись, что данные соответствуют задаче.